<!doctype html>

<style>
    html {
        margin: 0px 0px 0px 0px;
        width: 100%;
        height: 100%;
    }
    body {
        font-family: Calibri;
        width: 100%;
        height: 100%;
    }
    #content {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: auto;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
    }
</style>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Thời gian biểu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
  </head>
  <body>
    <style>
        
    </style>
        <div id="content">
            <div id="inputform">
                <div class="mb-4" id="inputfields">
                    <!-- <label for="data" class="form-label">Nhập trường dữ liệu</label>
                    <input type="text" class="form-control" id="data"> -->
                </div>
                <script>
                    for (let i = 0; i < 9; ++i) {

                        const input = document.createElement("input");
                        input.type = "text";
                        input.className = "form-control mb-2";
                        input.id = `data${i}`;
                        input.value = `${2 * i + 5}:00;${2 * i + 6}:00`;

                        const label = document.createElement("label");
                        label.htmlFor = input.id;
                        label.className = "form-label mb-2";
                        label.innerText = `Nhập khoảng cách ${2 * i + 1};${2 * i + 2}`;
                        

                        document.getElementById("inputfields").append(label, input);
                    }

                </script>
                <button class="btn btn-secondary mb-2" style="width:100%" onclick="setClock()">Xong</button>
                <button class="btn btn-secondary" style="width:100%" onClick="wakeLock(this)">Bật WakeLock</button>
            </div>
            <div id="clock" hidden style="display: grid; place-items: center;">
                <span id="thungay" style="font-size: 40pt; font-weight: bold;"></span>
                <span id="bias" style="font-size: 80pt; font-weight: bold; line-height: 60pt;"></span>
                <span id="curTime" style="font-size: 40pt; font-weight: bold;"></span>
            </div>
        </div>
    <script src="NoSleep.min.js"></script>
    <script>
        var noSleep = new NoSleep();
        function wakeLock(ev) {
            noSleep.enable();
            ev.setAttribute('hidden', '');
        }
        const thungay = document.getElementById("thungay");
        const curTime = document.getElementById("curTime");
        const biasElement = document.getElementById("bias");

        let [base, period, bias] = [0, 0, 0]
        const dayMap = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];

        const kc = [
            0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0
        ];

        function getSecondsInDay() {
            const date = new Date(Date.now());
            return {
                thuNgay: `${dayMap[date.getDay()]}-${date.getDate().toString().padStart(2, '0')}`,
                curHour: date.getHours().toString().padStart(2, '0'),
                curMinute: date.getMinutes().toString().padStart(2, '0'),
                seconds: date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds()
            }
        }

        function setClock() {
            for (let i = 0; i < 9; ++i) {
                const [red, green] = document.getElementById(`data${i}`).value.split(";").map(v => {
                    const [hour, minute] = v.split(":").map(v => parseInt(v));
                    return hour * 3600 + 60 * minute;
                });
                kc[2 * i] = red;
                kc[2 * i + 1] = green;
            }
            showClock();
        }


        function showClock() {
            setInterval(updateClock, 1000);
            updateClock();
            document.getElementById("inputform").setAttribute('hidden', '');
            document.getElementById("clock").removeAttribute('hidden');
        }
        let prevOffset = -1;

        const sound = new Audio("beep.mp3");
        const content = document.getElementById("content");

        function addSign(x) {
            return `${x < 0 ? '' : '+'}${x}`;
        }
        function updateClock() {
            const { thuNgay, curHour, curMinute, seconds } = getSecondsInDay()
            thungay.innerText = thuNgay;
            curTime.innerText = `${curHour}:${curMinute}`;

            let i;
            for (i = 0; i < 18; ++i) {
                if (seconds < kc[i]) {
                    break;
                }
            }
            const bias = (86400 + kc[i % 18] - seconds) % 86400;
            const hour = Math.floor(bias / 3600).toString().padStart(2, '0');
            const minute = Math.floor(bias / 60 % 60).toString().padStart(2, '0');
            content.style.backgroundColor = i % 2 ? "rgb(255, 0, 0)" : "rgb(0, 172, 0)";
            biasElement.innerText = `${hour}:${minute}`;
        }

    </script>
  </body>
</html>
