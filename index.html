<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Thời gian biểu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  </head>
  <body>
    <style>
        body {
            font-family: Calibri;
        }
        #content {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: auto;
            width: 100vw;
            height: 100vh;
            background-color: black;
            color: white;
        }
    </style>
        <!-- <video src="video.mp4" loop autoplay playsinline width="0" height="0"></video> -->
        <div id="content">
            <div id="inputform">
                <div class="mb-2">
                    <label for="data" class="form-label">Nhập trường dữ liệu</label>
                    <input type="text" class="form-control" id="data">
                </div>
                <button class="btn btn-secondary" style="width:100%" onclick="setClock()">Xong</button>
            </div>
            <div id="clock" hidden style="display: grid; place-items: center;">
                <div id="thungay" style="font-size: 40pt; font-weight: bold;"></div>
                <div id="counter" style="font-size: 100pt; font-weight: bold;"></div>
                <div id="curTime" style="font-size: 45pt; font-weight: bold;"></div>
            </div>
        </div>
    <script>
        const thungay = document.getElementById("thungay");
        const counter = document.getElementById("counter");
        const curTime = document.getElementById("curTime");

        let [base, period] = [0, 0]
        const dayMap = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];

        const prefix = ["F", "M", "L"];

        function getSecondsInDay() {
            const date = new Date(Date.now());
            return {
                thuNgay: `${dayMap[date.getDay()]}-${date.getDate() < 10 ? '0' + date.getDate() : date.getDate()}`,
                curHour: date.getHours(),
                curMinute: date.getMinutes(),
                seconds: date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds()
            }
        }

        function setClock() {
            const data = document.getElementById("data").value;
            base = parseInt(data.substr(0, 2)) * 3600 + parseInt(data.substr(2, 2)) * 60;
            period = parseFloat(data.substr(4)) * 60;
            showClock();
        }


        function showClock() {
            setInterval(updateClock, 1000);
            updateClock();
            document.getElementById("inputform").setAttribute('hidden', '');
            document.getElementById("clock").removeAttribute('hidden');
        }
        let prevOffset = -1;

        const sound = new Audio("beep.mp3");
        function updateClock() {
            const { thuNgay, curHour, curMinute, seconds } = getSecondsInDay();
            const cur = (seconds - base) / period;
            const fl = Math.floor(cur);
            let offset = Math.floor(100 * (cur - fl));
            if (offset < prevOffset) {
                sound.play();
            }
            prevOffset = offset;
            if (offset < 50) counter.style.color = "rgb(0, 159, 0)";
            else counter.style.color = "rgb(159, 0, 0)";

            offset = offset.toString();
            
            thungay.innerText = thuNgay;
            counter.innerText =  prefix[(3 + fl % 3) % 3] + (offset.length < 2 ? '0' + offset : offset);
            
            curTime.innerText = `${curHour < 10 ? '0' + curHour : curHour}:${curMinute < 10 ? '0' + curMinute : curMinute}`;
        }

        // Create the root video element
        var video = document.createElement('video');
        video.setAttribute('loop', '');
        video.setAttribute('playsinline', '');
        // Add some styles if needed
        video.setAttribute('style', 'position: fixed;');

        // A helper to add sources to video
        function addSourceToVideo(element, type, dataURI) {
            var source = document.createElement('source');
            source.src = dataURI;
            source.type = 'video/' + type;
            element.appendChild(source);
        }

        // A helper to concat base64
        var base64 = function(mimeType, base64) {
            return 'data:' + mimeType + ';base64,' + base64;
        };

        // Add Fake sourced
        addSourceToVideo(video,'webm', base64('video/webm', 'GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA='));
        addSourceToVideo(video, 'mp4', base64('video/mp4', 'AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=='));

        // Append the video to where ever you need
        document.body.appendChild(video);

        // Start playing video after any user interaction.
        // NOTE: Running video.play() handler without a user action may be blocked by browser.
        var playFn = function() {
            video.play();
            document.body.removeEventListener('touchend', playFn);
        };
        document.body.addEventListener('touchend', playFn);

    </script>
  </body>
</html>
